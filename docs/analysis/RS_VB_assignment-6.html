<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.37">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>rs_vb_assignment-6 – Varun Bhakri</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-b5e3097ca6bab6260ed4ce2e73d47aae.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-6bf0b08ca396cf31294168bc13d35783.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../analysis/index.html">Analysis</a></li><li class="breadcrumb-item"><a href="../analysis/RS_VB_assignment-6.html">Assignment 6: Predictive Modeling of Housing Prices in Philadelphia</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/vb.jpg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main">
    <a href="https://www.linkedin.com/in/varun-bhakhri/" title="LinkedIn" class="quarto-navigation-tool px-1" aria-label="LinkedIn"><i class="bi bi-globe"></i></a>
    <a href="https://github.com/vbhakhri" title="GitHub" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About Me</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/1-python-code-blocks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python code blocks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/2-static-images.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Showing static visualizations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/3-altair-hvplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Altair and Hvplot Charts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/4-folium.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interactive Maps with Folium</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/RS_VB_assignment-6.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Assignment 6: Predictive Modeling of Housing Prices in Philadelphia</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#assignment-6-predictive-modeling-of-housing-prices-in-philadelphia" id="toc-assignment-6-predictive-modeling-of-housing-prices-in-philadelphia" class="nav-link active" data-scroll-target="#assignment-6-predictive-modeling-of-housing-prices-in-philadelphia">Assignment 6: Predictive Modeling of Housing Prices in Philadelphia</a>
  <ul class="collapse">
  <li><a href="#part-2-modeling-philadelphias-housing-prices-and-algorithmic-fairness" id="toc-part-2-modeling-philadelphias-housing-prices-and-algorithmic-fairness" class="nav-link" data-scroll-target="#part-2-modeling-philadelphias-housing-prices-and-algorithmic-fairness">Part 2: Modeling Philadelphia’s Housing Prices and Algorithmic Fairness</a>
  <ul class="collapse">
  <li><a href="#load-data-from-the-office-of-property-assessment" id="toc-load-data-from-the-office-of-property-assessment" class="nav-link" data-scroll-target="#load-data-from-the-office-of-property-assessment">2.1 Load data from the Office of Property Assessment</a></li>
  <li><a href="#load-data-for-census-tracts-and-neighborhoods" id="toc-load-data-for-census-tracts-and-neighborhoods" class="nav-link" data-scroll-target="#load-data-for-census-tracts-and-neighborhoods">2.2 Load data for census tracts and neighborhoods</a></li>
  <li><a href="#spatially-join-the-sales-data-and-neighborhoodscensus-tracts." id="toc-spatially-join-the-sales-data-and-neighborhoodscensus-tracts." class="nav-link" data-scroll-target="#spatially-join-the-sales-data-and-neighborhoodscensus-tracts.">2.3 Spatially join the sales data and neighborhoods/census tracts.</a></li>
  <li><a href="#train-a-random-forest-on-the-sales-data" id="toc-train-a-random-forest-on-the-sales-data" class="nav-link" data-scroll-target="#train-a-random-forest-on-the-sales-data">2.4 Train a Random Forest on the sales data</a></li>
  <li><a href="#calculate-the-percent-error-of-your-model-predictions-for-each-sale-in-the-test-set" id="toc-calculate-the-percent-error-of-your-model-predictions-for-each-sale-in-the-test-set" class="nav-link" data-scroll-target="#calculate-the-percent-error-of-your-model-predictions-for-each-sale-in-the-test-set">2.5 Calculate the percent error of your model predictions for each sale in the test set</a></li>
  <li><a href="#make-a-data-frame-with-percent-errors-and-census-tract-info-for-each-sale-in-the-test-set" id="toc-make-a-data-frame-with-percent-errors-and-census-tract-info-for-each-sale-in-the-test-set" class="nav-link" data-scroll-target="#make-a-data-frame-with-percent-errors-and-census-tract-info-for-each-sale-in-the-test-set">2.6 Make a data frame with percent errors and census tract info for each sale in the test set</a></li>
  <li><a href="#plot-a-map-of-the-median-percent-error-by-census-tract" id="toc-plot-a-map-of-the-median-percent-error-by-census-tract" class="nav-link" data-scroll-target="#plot-a-map-of-the-median-percent-error-by-census-tract">2.8 Plot a map of the median percent error by census tract</a></li>
  <li><a href="#compare-the-percent-errors-in-qualifying-census-tracts-and-other-tracts" id="toc-compare-the-percent-errors-in-qualifying-census-tracts-and-other-tracts" class="nav-link" data-scroll-target="#compare-the-percent-errors-in-qualifying-census-tracts-and-other-tracts">2.9 Compare the percent errors in Qualifying Census Tracts and other tracts</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../analysis/index.html">Analysis</a></li><li class="breadcrumb-item"><a href="../analysis/RS_VB_assignment-6.html">Assignment 6: Predictive Modeling of Housing Prices in Philadelphia</a></li></ol></nav></header>




<p>Riya Saini &amp; Varun Bhakhri</p>
<section id="assignment-6-predictive-modeling-of-housing-prices-in-philadelphia" class="level1">
<h1>Assignment 6: Predictive Modeling of Housing Prices in Philadelphia</h1>
<p><strong>Due date: Wednesday, 12/6 by the end of the day</strong></p>
<p>Lectures 12B and 13A will cover predictive modeling of housing prices in Philadelphia. We’ll extend that analysis in this section by:</p>
<ul>
<li>Optimizing our hyperparameters during the modeling process using cross-validation and a grid search</li>
<li>Testing the fairness of our model by calculating the intersection of the model error rate and poverty rate across neighborhoods</li>
</ul>
<section id="part-2-modeling-philadelphias-housing-prices-and-algorithmic-fairness" class="level2">
<h2 class="anchored" data-anchor-id="part-2-modeling-philadelphias-housing-prices-and-algorithmic-fairness">Part 2: Modeling Philadelphia’s Housing Prices and Algorithmic Fairness</h2>
<section id="load-data-from-the-office-of-property-assessment" class="level3">
<h3 class="anchored" data-anchor-id="load-data-from-the-office-of-property-assessment">2.1 Load data from the Office of Property Assessment</h3>
<p>Use the requests package to query the CARTO API for <strong>single-family</strong> property assessment data in Philadelphia for properties that had their <strong>last sale during 2022</strong>.</p>
<p>Sources: - <a href="https://www.opendataphilly.org/dataset/opa-property-assessments">OpenDataPhilly</a> - <a href="http://metadata.phila.gov/#home/datasetdetails/5543865f20583086178c4ee5/representationdetails/55d624fdad35c7e854cb21a4/">Metadata</a></p>
<div id="cell-4" class="cell" data-tags="[]" data-execution_count="4">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> hvplot.pandas</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/javascript">
(function(root) {
  function now() {
    return new Date();
  }

  var force = true;
  var py_version = '3.2.1'.replace('rc', '-rc.').replace('.dev', '-dev.');
  var is_dev = py_version.indexOf("+") !== -1 || py_version.indexOf("-") !== -1;
  var reloading = false;
  var Bokeh = root.Bokeh;
  var bokeh_loaded = Bokeh != null && (Bokeh.version === py_version || (Bokeh.versions !== undefined && Bokeh.versions.has(py_version)));

  if (typeof (root._bokeh_timeout) === "undefined" || force) {
    root._bokeh_timeout = Date.now() + 5000;
    root._bokeh_failed_load = false;
  }

  function run_callbacks() {
    try {
      root._bokeh_onload_callbacks.forEach(function(callback) {
        if (callback != null)
          callback();
      });
    } finally {
      delete root._bokeh_onload_callbacks;
    }
    console.debug("Bokeh: all callbacks have finished");
  }

  function load_libs(css_urls, js_urls, js_modules, js_exports, callback) {
    if (css_urls == null) css_urls = [];
    if (js_urls == null) js_urls = [];
    if (js_modules == null) js_modules = [];
    if (js_exports == null) js_exports = {};

    root._bokeh_onload_callbacks.push(callback);

    if (root._bokeh_is_loading > 0) {
      console.debug("Bokeh: BokehJS is being loaded, scheduling callback at", now());
      return null;
    }
    if (js_urls.length === 0 && js_modules.length === 0 && Object.keys(js_exports).length === 0) {
      run_callbacks();
      return null;
    }
    if (!reloading) {
      console.debug("Bokeh: BokehJS not loaded, scheduling load and callback at", now());
    }

    function on_load() {
      root._bokeh_is_loading--;
      if (root._bokeh_is_loading === 0) {
        console.debug("Bokeh: all BokehJS libraries/stylesheets loaded");
        run_callbacks()
      }
    }
    window._bokeh_on_load = on_load

    function on_error() {
      console.error("failed to load " + url);
    }

    var skip = [];
    if (window.requirejs) {
      window.requirejs.config({'packages': {}, 'paths': {'jspanel': 'https://cdn.jsdelivr.net/npm/jspanel4@4.12.0/dist/jspanel', 'jspanel-modal': 'https://cdn.jsdelivr.net/npm/jspanel4@4.12.0/dist/extensions/modal/jspanel.modal', 'jspanel-tooltip': 'https://cdn.jsdelivr.net/npm/jspanel4@4.12.0/dist/extensions/tooltip/jspanel.tooltip', 'jspanel-hint': 'https://cdn.jsdelivr.net/npm/jspanel4@4.12.0/dist/extensions/hint/jspanel.hint', 'jspanel-layout': 'https://cdn.jsdelivr.net/npm/jspanel4@4.12.0/dist/extensions/layout/jspanel.layout', 'jspanel-contextmenu': 'https://cdn.jsdelivr.net/npm/jspanel4@4.12.0/dist/extensions/contextmenu/jspanel.contextmenu', 'jspanel-dock': 'https://cdn.jsdelivr.net/npm/jspanel4@4.12.0/dist/extensions/dock/jspanel.dock', 'gridstack': 'https://cdn.jsdelivr.net/npm/gridstack@7.2.3/dist/gridstack-all', 'notyf': 'https://cdn.jsdelivr.net/npm/notyf@3/notyf.min'}, 'shim': {'jspanel': {'exports': 'jsPanel'}, 'gridstack': {'exports': 'GridStack'}}});
      require(["jspanel"], function(jsPanel) {
    window.jsPanel = jsPanel
    on_load()
      })
      require(["jspanel-modal"], function() {
    on_load()
      })
      require(["jspanel-tooltip"], function() {
    on_load()
      })
      require(["jspanel-hint"], function() {
    on_load()
      })
      require(["jspanel-layout"], function() {
    on_load()
      })
      require(["jspanel-contextmenu"], function() {
    on_load()
      })
      require(["jspanel-dock"], function() {
    on_load()
      })
      require(["gridstack"], function(GridStack) {
    window.GridStack = GridStack
    on_load()
      })
      require(["notyf"], function() {
    on_load()
      })
      root._bokeh_is_loading = css_urls.length + 9;
    } else {
      root._bokeh_is_loading = css_urls.length + js_urls.length + js_modules.length + Object.keys(js_exports).length;
    }

    var existing_stylesheets = []
    var links = document.getElementsByTagName('link')
    for (var i = 0; i < links.length; i++) {
      var link = links[i]
      if (link.href != null) {
    existing_stylesheets.push(link.href)
      }
    }
    for (var i = 0; i < css_urls.length; i++) {
      var url = css_urls[i];
      if (existing_stylesheets.indexOf(url) !== -1) {
    on_load()
    continue;
      }
      const element = document.createElement("link");
      element.onload = on_load;
      element.onerror = on_error;
      element.rel = "stylesheet";
      element.type = "text/css";
      element.href = url;
      console.debug("Bokeh: injecting link tag for BokehJS stylesheet: ", url);
      document.body.appendChild(element);
    }    if (((window['jsPanel'] !== undefined) && (!(window['jsPanel'] instanceof HTMLElement))) || window.requirejs) {
      var urls = ['https://cdn.holoviz.org/panel/1.2.1/dist/bundled/floatpanel/jspanel4@4.12.0/dist/jspanel.js', 'https://cdn.holoviz.org/panel/1.2.1/dist/bundled/floatpanel/jspanel4@4.12.0/dist/extensions/modal/jspanel.modal.js', 'https://cdn.holoviz.org/panel/1.2.1/dist/bundled/floatpanel/jspanel4@4.12.0/dist/extensions/tooltip/jspanel.tooltip.js', 'https://cdn.holoviz.org/panel/1.2.1/dist/bundled/floatpanel/jspanel4@4.12.0/dist/extensions/hint/jspanel.hint.js', 'https://cdn.holoviz.org/panel/1.2.1/dist/bundled/floatpanel/jspanel4@4.12.0/dist/extensions/layout/jspanel.layout.js', 'https://cdn.holoviz.org/panel/1.2.1/dist/bundled/floatpanel/jspanel4@4.12.0/dist/extensions/contextmenu/jspanel.contextmenu.js', 'https://cdn.holoviz.org/panel/1.2.1/dist/bundled/floatpanel/jspanel4@4.12.0/dist/extensions/dock/jspanel.dock.js'];
      for (var i = 0; i < urls.length; i++) {
        skip.push(urls[i])
      }
    }    if (((window['GridStack'] !== undefined) && (!(window['GridStack'] instanceof HTMLElement))) || window.requirejs) {
      var urls = ['https://cdn.holoviz.org/panel/1.2.1/dist/bundled/gridstack/gridstack@7.2.3/dist/gridstack-all.js'];
      for (var i = 0; i < urls.length; i++) {
        skip.push(urls[i])
      }
    }    if (((window['Notyf'] !== undefined) && (!(window['Notyf'] instanceof HTMLElement))) || window.requirejs) {
      var urls = ['https://cdn.holoviz.org/panel/1.2.1/dist/bundled/notificationarea/notyf@3/notyf.min.js'];
      for (var i = 0; i < urls.length; i++) {
        skip.push(urls[i])
      }
    }    var existing_scripts = []
    var scripts = document.getElementsByTagName('script')
    for (var i = 0; i < scripts.length; i++) {
      var script = scripts[i]
      if (script.src != null) {
    existing_scripts.push(script.src)
      }
    }
    for (var i = 0; i < js_urls.length; i++) {
      var url = js_urls[i];
      if (skip.indexOf(url) !== -1 || existing_scripts.indexOf(url) !== -1) {
    if (!window.requirejs) {
      on_load();
    }
    continue;
      }
      var element = document.createElement('script');
      element.onload = on_load;
      element.onerror = on_error;
      element.async = false;
      element.src = url;
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      document.head.appendChild(element);
    }
    for (var i = 0; i < js_modules.length; i++) {
      var url = js_modules[i];
      if (skip.indexOf(url) !== -1 || existing_scripts.indexOf(url) !== -1) {
    if (!window.requirejs) {
      on_load();
    }
    continue;
      }
      var element = document.createElement('script');
      element.onload = on_load;
      element.onerror = on_error;
      element.async = false;
      element.src = url;
      element.type = "module";
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      document.head.appendChild(element);
    }
    for (const name in js_exports) {
      var url = js_exports[name];
      if (skip.indexOf(url) >= 0 || root[name] != null) {
    if (!window.requirejs) {
      on_load();
    }
    continue;
      }
      var element = document.createElement('script');
      element.onerror = on_error;
      element.async = false;
      element.type = "module";
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      element.textContent = `
      import ${name} from "${url}"
      window.${name} = ${name}
      window._bokeh_on_load()
      `
      document.head.appendChild(element);
    }
    if (!js_urls.length && !js_modules.length) {
      on_load()
    }
  };

  function inject_raw_css(css) {
    const element = document.createElement("style");
    element.appendChild(document.createTextNode(css));
    document.body.appendChild(element);
  }

  var js_urls = ["https://cdn.bokeh.org/bokeh/release/bokeh-3.2.1.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-gl-3.2.1.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-widgets-3.2.1.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-tables-3.2.1.min.js", "https://cdn.holoviz.org/panel/1.2.1/dist/panel.min.js"];
  var js_modules = [];
  var js_exports = {};
  var css_urls = [];
  var inline_js = [    function(Bokeh) {
      Bokeh.set_log_level("info");
    },
function(Bokeh) {} // ensure no trailing comma for IE
  ];

  function run_inline_js() {
    if ((root.Bokeh !== undefined) || (force === true)) {
      for (var i = 0; i < inline_js.length; i++) {
        inline_js[i].call(root, root.Bokeh);
      }
      // Cache old bokeh versions
      if (Bokeh != undefined && !reloading) {
    var NewBokeh = root.Bokeh;
    if (Bokeh.versions === undefined) {
      Bokeh.versions = new Map();
    }
    if (NewBokeh.version !== Bokeh.version) {
      Bokeh.versions.set(NewBokeh.version, NewBokeh)
    }
    root.Bokeh = Bokeh;
      }} else if (Date.now() < root._bokeh_timeout) {
      setTimeout(run_inline_js, 100);
    } else if (!root._bokeh_failed_load) {
      console.log("Bokeh: BokehJS failed to load within specified timeout.");
      root._bokeh_failed_load = true;
    }
    root._bokeh_is_initializing = false
  }

  function load_or_wait() {
    // Implement a backoff loop that tries to ensure we do not load multiple
    // versions of Bokeh and its dependencies at the same time.
    // In recent versions we use the root._bokeh_is_initializing flag
    // to determine whether there is an ongoing attempt to initialize
    // bokeh, however for backward compatibility we also try to ensure
    // that we do not start loading a newer (Panel>=1.0 and Bokeh>3) version
    // before older versions are fully initialized.
    if (root._bokeh_is_initializing && Date.now() > root._bokeh_timeout) {
      root._bokeh_is_initializing = false;
      root._bokeh_onload_callbacks = undefined;
      console.log("Bokeh: BokehJS was loaded multiple times but one version failed to initialize.");
      load_or_wait();
    } else if (root._bokeh_is_initializing || (typeof root._bokeh_is_initializing === "undefined" && root._bokeh_onload_callbacks !== undefined)) {
      setTimeout(load_or_wait, 100);
    } else {
      Bokeh = root.Bokeh;
      bokeh_loaded = Bokeh != null && (Bokeh.version === py_version || (Bokeh.versions !== undefined && Bokeh.versions.has(py_version)));
      root._bokeh_is_initializing = true
      root._bokeh_onload_callbacks = []
      if (!reloading && (!bokeh_loaded || is_dev)) {
    root.Bokeh = undefined;
      }
      load_libs(css_urls, js_urls, js_modules, js_exports, function() {
    console.debug("Bokeh: BokehJS plotting callback run at", now());
    run_inline_js();
      });
    }
  }
  // Give older versions of the autoload script a head-start to ensure
  // they initialize before we start loading newer version.
  setTimeout(load_or_wait, 100)
}(window));
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/javascript">

if ((window.PyViz === undefined) || (window.PyViz instanceof HTMLElement)) {
  window.PyViz = {comms: {}, comm_status:{}, kernels:{}, receivers: {}, plot_index: []}
}


    function JupyterCommManager() {
    }

    JupyterCommManager.prototype.register_target = function(plot_id, comm_id, msg_handler) {
      if (window.comm_manager || ((window.Jupyter !== undefined) && (Jupyter.notebook.kernel != null))) {
        var comm_manager = window.comm_manager || Jupyter.notebook.kernel.comm_manager;
        comm_manager.register_target(comm_id, function(comm) {
          comm.on_msg(msg_handler);
        });
      } else if ((plot_id in window.PyViz.kernels) && (window.PyViz.kernels[plot_id])) {
        window.PyViz.kernels[plot_id].registerCommTarget(comm_id, function(comm) {
          comm.onMsg = msg_handler;
        });
      } else if (typeof google != 'undefined' && google.colab.kernel != null) {
        google.colab.kernel.comms.registerTarget(comm_id, (comm) => {
          var messages = comm.messages[Symbol.asyncIterator]();
          function processIteratorResult(result) {
            var message = result.value;
            console.log(message)
            var content = {data: message.data, comm_id};
            var buffers = []
            for (var buffer of message.buffers || []) {
              buffers.push(new DataView(buffer))
            }
            var metadata = message.metadata || {};
            var msg = {content, buffers, metadata}
            msg_handler(msg);
            return messages.next().then(processIteratorResult);
          }
          return messages.next().then(processIteratorResult);
        })
      }
    }

    JupyterCommManager.prototype.get_client_comm = function(plot_id, comm_id, msg_handler) {
      if (comm_id in window.PyViz.comms) {
        return window.PyViz.comms[comm_id];
      } else if (window.comm_manager || ((window.Jupyter !== undefined) && (Jupyter.notebook.kernel != null))) {
        var comm_manager = window.comm_manager || Jupyter.notebook.kernel.comm_manager;
        var comm = comm_manager.new_comm(comm_id, {}, {}, {}, comm_id);
        if (msg_handler) {
          comm.on_msg(msg_handler);
        }
      } else if ((plot_id in window.PyViz.kernels) && (window.PyViz.kernels[plot_id])) {
        var comm = window.PyViz.kernels[plot_id].connectToComm(comm_id);
        comm.open();
        if (msg_handler) {
          comm.onMsg = msg_handler;
        }
      } else if (typeof google != 'undefined' && google.colab.kernel != null) {
        var comm_promise = google.colab.kernel.comms.open(comm_id)
        comm_promise.then((comm) => {
          window.PyViz.comms[comm_id] = comm;
          if (msg_handler) {
            var messages = comm.messages[Symbol.asyncIterator]();
            function processIteratorResult(result) {
              var message = result.value;
              var content = {data: message.data};
              var metadata = message.metadata || {comm_id};
              var msg = {content, metadata}
              msg_handler(msg);
              return messages.next().then(processIteratorResult);
            }
            return messages.next().then(processIteratorResult);
          }
        }) 
        var sendClosure = (data, metadata, buffers, disposeOnDone) => {
          return comm_promise.then((comm) => {
            comm.send(data, metadata, buffers, disposeOnDone);
          });
        };
        var comm = {
          send: sendClosure
        };
      }
      window.PyViz.comms[comm_id] = comm;
      return comm;
    }
    window.PyViz.comm_manager = new JupyterCommManager();
    


var JS_MIME_TYPE = 'application/javascript';
var HTML_MIME_TYPE = 'text/html';
var EXEC_MIME_TYPE = 'application/vnd.holoviews_exec.v0+json';
var CLASS_NAME = 'output';

/**
 * Render data to the DOM node
 */
function render(props, node) {
  var div = document.createElement("div");
  var script = document.createElement("script");
  node.appendChild(div);
  node.appendChild(script);
}

/**
 * Handle when a new output is added
 */
function handle_add_output(event, handle) {
  var output_area = handle.output_area;
  var output = handle.output;
  if ((output.data == undefined) || (!output.data.hasOwnProperty(EXEC_MIME_TYPE))) {
    return
  }
  var id = output.metadata[EXEC_MIME_TYPE]["id"];
  var toinsert = output_area.element.find("." + CLASS_NAME.split(' ')[0]);
  if (id !== undefined) {
    var nchildren = toinsert.length;
    var html_node = toinsert[nchildren-1].children[0];
    html_node.innerHTML = output.data[HTML_MIME_TYPE];
    var scripts = [];
    var nodelist = html_node.querySelectorAll("script");
    for (var i in nodelist) {
      if (nodelist.hasOwnProperty(i)) {
        scripts.push(nodelist[i])
      }
    }

    scripts.forEach( function (oldScript) {
      var newScript = document.createElement("script");
      var attrs = [];
      var nodemap = oldScript.attributes;
      for (var j in nodemap) {
        if (nodemap.hasOwnProperty(j)) {
          attrs.push(nodemap[j])
        }
      }
      attrs.forEach(function(attr) { newScript.setAttribute(attr.name, attr.value) });
      newScript.appendChild(document.createTextNode(oldScript.innerHTML));
      oldScript.parentNode.replaceChild(newScript, oldScript);
    });
    if (JS_MIME_TYPE in output.data) {
      toinsert[nchildren-1].children[1].textContent = output.data[JS_MIME_TYPE];
    }
    output_area._hv_plot_id = id;
    if ((window.Bokeh !== undefined) && (id in Bokeh.index)) {
      window.PyViz.plot_index[id] = Bokeh.index[id];
    } else {
      window.PyViz.plot_index[id] = null;
    }
  } else if (output.metadata[EXEC_MIME_TYPE]["server_id"] !== undefined) {
    var bk_div = document.createElement("div");
    bk_div.innerHTML = output.data[HTML_MIME_TYPE];
    var script_attrs = bk_div.children[0].attributes;
    for (var i = 0; i < script_attrs.length; i++) {
      toinsert[toinsert.length - 1].childNodes[1].setAttribute(script_attrs[i].name, script_attrs[i].value);
    }
    // store reference to server id on output_area
    output_area._bokeh_server_id = output.metadata[EXEC_MIME_TYPE]["server_id"];
  }
}

/**
 * Handle when an output is cleared or removed
 */
function handle_clear_output(event, handle) {
  var id = handle.cell.output_area._hv_plot_id;
  var server_id = handle.cell.output_area._bokeh_server_id;
  if (((id === undefined) || !(id in PyViz.plot_index)) && (server_id !== undefined)) { return; }
  var comm = window.PyViz.comm_manager.get_client_comm("hv-extension-comm", "hv-extension-comm", function () {});
  if (server_id !== null) {
    comm.send({event_type: 'server_delete', 'id': server_id});
    return;
  } else if (comm !== null) {
    comm.send({event_type: 'delete', 'id': id});
  }
  delete PyViz.plot_index[id];
  if ((window.Bokeh !== undefined) & (id in window.Bokeh.index)) {
    var doc = window.Bokeh.index[id].model.document
    doc.clear();
    const i = window.Bokeh.documents.indexOf(doc);
    if (i > -1) {
      window.Bokeh.documents.splice(i, 1);
    }
  }
}

/**
 * Handle kernel restart event
 */
function handle_kernel_cleanup(event, handle) {
  delete PyViz.comms["hv-extension-comm"];
  window.PyViz.plot_index = {}
}

/**
 * Handle update_display_data messages
 */
function handle_update_output(event, handle) {
  handle_clear_output(event, {cell: {output_area: handle.output_area}})
  handle_add_output(event, handle)
}

function register_renderer(events, OutputArea) {
  function append_mime(data, metadata, element) {
    // create a DOM node to render to
    var toinsert = this.create_output_subarea(
    metadata,
    CLASS_NAME,
    EXEC_MIME_TYPE
    );
    this.keyboard_manager.register_events(toinsert);
    // Render to node
    var props = {data: data, metadata: metadata[EXEC_MIME_TYPE]};
    render(props, toinsert[0]);
    element.append(toinsert);
    return toinsert
  }

  events.on('output_added.OutputArea', handle_add_output);
  events.on('output_updated.OutputArea', handle_update_output);
  events.on('clear_output.CodeCell', handle_clear_output);
  events.on('delete.Cell', handle_clear_output);
  events.on('kernel_ready.Kernel', handle_kernel_cleanup);

  OutputArea.prototype.register_mime_type(EXEC_MIME_TYPE, append_mime, {
    safe: true,
    index: 0
  });
}

if (window.Jupyter !== undefined) {
  try {
    var events = require('base/js/events');
    var OutputArea = require('notebook/js/outputarea').OutputArea;
    if (OutputArea.prototype.mime_types().indexOf(EXEC_MIME_TYPE) == -1) {
      register_renderer(events, OutputArea);
    }
  } catch(err) {
  }
}

</script>
</div>
<div class="cell-output cell-output-display">
<style>*[data-root-id],
*[data-root-id] > * {
  box-sizing: border-box;
  font-family: var(--jp-ui-font-family);
  font-size: var(--jp-ui-font-size1);
  color: var(--vscode-editor-foreground, var(--jp-ui-font-color1));
}

/* Override VSCode background color */
.cell-output-ipywidget-background:has(
    > .cell-output-ipywidget-background > .lm-Widget > *[data-root-id]
  ),
.cell-output-ipywidget-background:has(> .lm-Widget > *[data-root-id]) {
  background-color: transparent !important;
}
</style>
</div>
</div>
<div id="cell-5" class="cell" data-tags="[]" data-execution_count="5">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the CARTO API url</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>carto_url <span class="op">=</span> <span class="st">"https://phl.carto.com/api/v2/sql"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Only pull 2022 sales for single family residential properties</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>where <span class="op">=</span> <span class="st">"sale_date &gt;= '2022-01-01' and sale_date &lt;= '2022-12-31'"</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>where <span class="op">=</span> where <span class="op">+</span> <span class="st">" and category_code_description IN ('SINGLE FAMILY', 'Single Family')"</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the query</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="ss">f"SELECT * FROM opa_properties_public WHERE </span><span class="sc">{</span>where<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the request</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">"q"</span>: query, <span class="st">"format"</span>: <span class="st">"geojson"</span>}</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(carto_url, params<span class="op">=</span>params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-6" class="cell" data-tags="[]" data-execution_count="6">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the GeoDataFrame</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>salesRaw <span class="op">=</span> gpd.GeoDataFrame.from_features(response.json(), crs<span class="op">=</span><span class="st">"EPSG:4326"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: put it a reproducible order for test/training splits later</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>salesRaw <span class="op">=</span> salesRaw.sort_values(<span class="st">"parcel_number"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-7" class="cell" data-tags="[]" data-execution_count="7">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Selecting columns:</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> [</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sale_price"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"total_livable_area"</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"total_area"</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"garage_spaces"</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fireplaces"</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"number_of_bathrooms"</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"number_of_bedrooms"</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"number_stories"</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"exterior_condition"</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"zip_code"</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Trim to these columns and remove NaNs</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>sales <span class="op">=</span> salesRaw[cols <span class="op">+</span> [<span class="st">"geometry"</span>]].dropna()</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Trim zip code to only the first five digits</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>sales[<span class="st">"zip_code"</span>] <span class="op">=</span> sales[<span class="st">"zip_code"</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.<span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-8" class="cell" data-tags="[]" data-execution_count="8">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>sales.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sale_price</th>
<th data-quarto-table-cell-role="th">total_livable_area</th>
<th data-quarto-table-cell-role="th">total_area</th>
<th data-quarto-table-cell-role="th">garage_spaces</th>
<th data-quarto-table-cell-role="th">fireplaces</th>
<th data-quarto-table-cell-role="th">number_of_bathrooms</th>
<th data-quarto-table-cell-role="th">number_of_bedrooms</th>
<th data-quarto-table-cell-role="th">number_stories</th>
<th data-quarto-table-cell-role="th">exterior_condition</th>
<th data-quarto-table-cell-role="th">zip_code</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1133</td>
<td>450000.0</td>
<td>1785.0</td>
<td>1625.0</td>
<td>1.0</td>
<td>0.0</td>
<td>2.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4</td>
<td>19147</td>
<td>POINT (-75.14860 39.93145)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13106</td>
<td>670000.0</td>
<td>2244.0</td>
<td>1224.0</td>
<td>0.0</td>
<td>0.0</td>
<td>3.0</td>
<td>4.0</td>
<td>3.0</td>
<td>3</td>
<td>19147</td>
<td>POINT (-75.14817 39.93101)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7860</td>
<td>790000.0</td>
<td>2514.0</td>
<td>1400.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>3.0</td>
<td>2.0</td>
<td>3</td>
<td>19147</td>
<td>POINT (-75.14781 39.93010)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">835</td>
<td>195000.0</td>
<td>1358.0</td>
<td>840.0</td>
<td>0.0</td>
<td>0.0</td>
<td>2.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4</td>
<td>19147</td>
<td>POINT (-75.14887 39.93026)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12456</td>
<td>331000.0</td>
<td>868.0</td>
<td>546.0</td>
<td>0.0</td>
<td>0.0</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>4</td>
<td>19147</td>
<td>POINT (-75.14881 39.93012)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="load-data-for-census-tracts-and-neighborhoods" class="level3">
<h3 class="anchored" data-anchor-id="load-data-for-census-tracts-and-neighborhoods">2.2 Load data for census tracts and neighborhoods</h3>
<p>Load various Philadelphia-based regions that we will use in our analysis.</p>
<ul>
<li>Census tracts can be downloaded from: <a href="https://opendata.arcgis.com/datasets/8bc0786524a4486bb3cf0f9862ad0fbf_0.geojson">https://opendata.arcgis.com/datasets/8bc0786524a4486bb3cf0f9862ad0fbf_0.geojson</a></li>
<li>Neighborhoods can be downloaded from: <a href="https://raw.githubusercontent.com/azavea/geo-data/master/Neighborhoods_Philadelphia/Neighborhoods_Philadelphia.geojson">https://raw.githubusercontent.com/azavea/geo-data/master/Neighborhoods_Philadelphia/Neighborhoods_Philadelphia.geojson</a></li>
</ul>
<div id="cell-10" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>tracts <span class="op">=</span> gpd.read_file(<span class="st">"Data/Census_Tracts_2010.geojson"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>neighborhoods <span class="op">=</span> gpd.read_file(<span class="st">"Data/philadelphia-neighborhoods.geojson"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-11" class="cell" data-tags="[]" data-execution_count="10">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>tracts.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">OBJECTID</th>
<th data-quarto-table-cell-role="th">STATEFP10</th>
<th data-quarto-table-cell-role="th">COUNTYFP10</th>
<th data-quarto-table-cell-role="th">TRACTCE10</th>
<th data-quarto-table-cell-role="th">GEOID10</th>
<th data-quarto-table-cell-role="th">NAME10</th>
<th data-quarto-table-cell-role="th">NAMELSAD10</th>
<th data-quarto-table-cell-role="th">MTFCC10</th>
<th data-quarto-table-cell-role="th">FUNCSTAT10</th>
<th data-quarto-table-cell-role="th">ALAND10</th>
<th data-quarto-table-cell-role="th">AWATER10</th>
<th data-quarto-table-cell-role="th">INTPTLAT10</th>
<th data-quarto-table-cell-role="th">INTPTLON10</th>
<th data-quarto-table-cell-role="th">LOGRECNO</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>42</td>
<td>101</td>
<td>009400</td>
<td>42101009400</td>
<td>94</td>
<td>Census Tract 94</td>
<td>G5020</td>
<td>S</td>
<td>366717</td>
<td>0</td>
<td>+39.9632709</td>
<td>-075.2322437</td>
<td>10429</td>
<td>POLYGON ((-75.22927 39.96054, -75.22865 39.960...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>42</td>
<td>101</td>
<td>009500</td>
<td>42101009500</td>
<td>95</td>
<td>Census Tract 95</td>
<td>G5020</td>
<td>S</td>
<td>319070</td>
<td>0</td>
<td>+39.9658709</td>
<td>-075.2379140</td>
<td>10430</td>
<td>POLYGON ((-75.23536 39.96852, -75.23545 39.969...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>42</td>
<td>101</td>
<td>009600</td>
<td>42101009600</td>
<td>96</td>
<td>Census Tract 96</td>
<td>G5020</td>
<td>S</td>
<td>405273</td>
<td>0</td>
<td>+39.9655396</td>
<td>-075.2435075</td>
<td>10431</td>
<td>POLYGON ((-75.24343 39.96230, -75.24339 39.962...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>42</td>
<td>101</td>
<td>013800</td>
<td>42101013800</td>
<td>138</td>
<td>Census Tract 138</td>
<td>G5020</td>
<td>S</td>
<td>341256</td>
<td>0</td>
<td>+39.9764504</td>
<td>-075.1771771</td>
<td>10468</td>
<td>POLYGON ((-75.17341 39.97779, -75.17386 39.977...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>42</td>
<td>101</td>
<td>013900</td>
<td>42101013900</td>
<td>139</td>
<td>Census Tract 139</td>
<td>G5020</td>
<td>S</td>
<td>562934</td>
<td>0</td>
<td>+39.9750563</td>
<td>-075.1711846</td>
<td>10469</td>
<td>POLYGON ((-75.17313 39.97776, -75.17321 39.977...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-12" class="cell" data-tags="[]" data-execution_count="11">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>neighborhoods.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">NAME</th>
<th data-quarto-table-cell-role="th">LISTNAME</th>
<th data-quarto-table-cell-role="th">MAPNAME</th>
<th data-quarto-table-cell-role="th">Shape_Leng</th>
<th data-quarto-table-cell-role="th">Shape_Area</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>BRIDESBURG</td>
<td>Bridesburg</td>
<td>Bridesburg</td>
<td>27814.546521</td>
<td>4.458626e+07</td>
<td>MULTIPOLYGON (((-75.06773 40.00540, -75.06765 ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>BUSTLETON</td>
<td>Bustleton</td>
<td>Bustleton</td>
<td>48868.458365</td>
<td>1.140504e+08</td>
<td>MULTIPOLYGON (((-75.01560 40.09487, -75.01768 ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>CEDARBROOK</td>
<td>Cedarbrook</td>
<td>Cedarbrook</td>
<td>20021.415802</td>
<td>2.487174e+07</td>
<td>MULTIPOLYGON (((-75.18848 40.07273, -75.18846 ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>CHESTNUT_HILL</td>
<td>Chestnut Hill</td>
<td>Chestnut Hill</td>
<td>56394.297195</td>
<td>7.966498e+07</td>
<td>MULTIPOLYGON (((-75.21221 40.08604, -75.21210 ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>EAST_FALLS</td>
<td>East Falls</td>
<td>East Falls</td>
<td>27400.776417</td>
<td>4.057689e+07</td>
<td>MULTIPOLYGON (((-75.18476 40.02829, -75.18426 ...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="spatially-join-the-sales-data-and-neighborhoodscensus-tracts." class="level3">
<h3 class="anchored" data-anchor-id="spatially-join-the-sales-data-and-neighborhoodscensus-tracts.">2.3 Spatially join the sales data and neighborhoods/census tracts.</h3>
<p>Perform a spatial join, such that each sale has an associated neighborhood and census tract.</p>
<p><strong>Note:</strong> After performing the first spatial join, you will need to use the <code>drop()</code> function to remove the <code>index_right</code> column; otherwise an error will be raised on the second spatial join about duplicate columns.</p>
<div id="cell-14" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>sales_geo1 <span class="op">=</span> gpd.sjoin(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    sales,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    tracts,         <span class="co"># Polygon data</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">"left"</span>,            <span class="co"># Type of join: 'left', 'inner', or 'right'</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    predicate<span class="op">=</span><span class="st">"intersects"</span> <span class="co"># Use "intersects" to join based on spatial intersection</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-15" class="cell" data-tags="[]" data-execution_count="13">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>sales_geo1 <span class="op">=</span> sales_geo1.drop(columns<span class="op">=</span>[<span class="st">'index_left'</span>, <span class="st">'index_right'</span>], errors<span class="op">=</span><span class="st">'ignore'</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>neighborhoods <span class="op">=</span> neighborhoods.drop(columns<span class="op">=</span>[<span class="st">'index_left'</span>, <span class="st">'index_right'</span>], errors<span class="op">=</span><span class="st">'ignore'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-16" class="cell" data-tags="[]" data-execution_count="14">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>sales_geo2 <span class="op">=</span> gpd.sjoin(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    sales_geo1,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    neighborhoods,         <span class="co"># Polygon data</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">"left"</span>,            <span class="co"># Type of join: 'left', 'inner', or 'right'</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    predicate<span class="op">=</span><span class="st">"intersects"</span> <span class="co"># Use "intersects" to join based on spatial intersection</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-17" class="cell" data-tags="[]" data-execution_count="15">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>sales_geo2.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sale_price</th>
<th data-quarto-table-cell-role="th">total_livable_area</th>
<th data-quarto-table-cell-role="th">total_area</th>
<th data-quarto-table-cell-role="th">garage_spaces</th>
<th data-quarto-table-cell-role="th">fireplaces</th>
<th data-quarto-table-cell-role="th">number_of_bathrooms</th>
<th data-quarto-table-cell-role="th">number_of_bedrooms</th>
<th data-quarto-table-cell-role="th">number_stories</th>
<th data-quarto-table-cell-role="th">exterior_condition</th>
<th data-quarto-table-cell-role="th">zip_code</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">AWATER10</th>
<th data-quarto-table-cell-role="th">INTPTLAT10</th>
<th data-quarto-table-cell-role="th">INTPTLON10</th>
<th data-quarto-table-cell-role="th">LOGRECNO</th>
<th data-quarto-table-cell-role="th">index_right</th>
<th data-quarto-table-cell-role="th">NAME</th>
<th data-quarto-table-cell-role="th">LISTNAME</th>
<th data-quarto-table-cell-role="th">MAPNAME</th>
<th data-quarto-table-cell-role="th">Shape_Leng</th>
<th data-quarto-table-cell-role="th">Shape_Area</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1133</td>
<td>450000.0</td>
<td>1785.0</td>
<td>1625.0</td>
<td>1.0</td>
<td>0.0</td>
<td>2.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4</td>
<td>19147</td>
<td>...</td>
<td>0</td>
<td>+39.9280114</td>
<td>-075.1495606</td>
<td>10368</td>
<td>154</td>
<td>PENNSPORT</td>
<td>Pennsport</td>
<td>Pennsport</td>
<td>11823.233108</td>
<td>6.492473e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13106</td>
<td>670000.0</td>
<td>2244.0</td>
<td>1224.0</td>
<td>0.0</td>
<td>0.0</td>
<td>3.0</td>
<td>4.0</td>
<td>3.0</td>
<td>3</td>
<td>19147</td>
<td>...</td>
<td>0</td>
<td>+39.9280114</td>
<td>-075.1495606</td>
<td>10368</td>
<td>154</td>
<td>PENNSPORT</td>
<td>Pennsport</td>
<td>Pennsport</td>
<td>11823.233108</td>
<td>6.492473e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7860</td>
<td>790000.0</td>
<td>2514.0</td>
<td>1400.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>3.0</td>
<td>2.0</td>
<td>3</td>
<td>19147</td>
<td>...</td>
<td>0</td>
<td>+39.9280114</td>
<td>-075.1495606</td>
<td>10368</td>
<td>154</td>
<td>PENNSPORT</td>
<td>Pennsport</td>
<td>Pennsport</td>
<td>11823.233108</td>
<td>6.492473e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">835</td>
<td>195000.0</td>
<td>1358.0</td>
<td>840.0</td>
<td>0.0</td>
<td>0.0</td>
<td>2.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4</td>
<td>19147</td>
<td>...</td>
<td>0</td>
<td>+39.9280114</td>
<td>-075.1495606</td>
<td>10368</td>
<td>154</td>
<td>PENNSPORT</td>
<td>Pennsport</td>
<td>Pennsport</td>
<td>11823.233108</td>
<td>6.492473e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12456</td>
<td>331000.0</td>
<td>868.0</td>
<td>546.0</td>
<td>0.0</td>
<td>0.0</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>4</td>
<td>19147</td>
<td>...</td>
<td>0</td>
<td>+39.9280114</td>
<td>-075.1495606</td>
<td>10368</td>
<td>154</td>
<td>PENNSPORT</td>
<td>Pennsport</td>
<td>Pennsport</td>
<td>11823.233108</td>
<td>6.492473e+06</td>
</tr>
</tbody>
</table>

<p>5 rows × 31 columns</p>
</div>
</div>
</div>
<div id="cell-18" class="cell" data-tags="[]" data-execution_count="16">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check columns:</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sales_geo1.columns)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sales_geo2.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Index(['sale_price', 'total_livable_area', 'total_area', 'garage_spaces',
       'fireplaces', 'number_of_bathrooms', 'number_of_bedrooms',
       'number_stories', 'exterior_condition', 'zip_code', 'geometry',
       'OBJECTID', 'STATEFP10', 'COUNTYFP10', 'TRACTCE10', 'GEOID10', 'NAME10',
       'NAMELSAD10', 'MTFCC10', 'FUNCSTAT10', 'ALAND10', 'AWATER10',
       'INTPTLAT10', 'INTPTLON10', 'LOGRECNO'],
      dtype='object')
Index(['sale_price', 'total_livable_area', 'total_area', 'garage_spaces',
       'fireplaces', 'number_of_bathrooms', 'number_of_bedrooms',
       'number_stories', 'exterior_condition', 'zip_code', 'geometry',
       'OBJECTID', 'STATEFP10', 'COUNTYFP10', 'TRACTCE10', 'GEOID10', 'NAME10',
       'NAMELSAD10', 'MTFCC10', 'FUNCSTAT10', 'ALAND10', 'AWATER10',
       'INTPTLAT10', 'INTPTLON10', 'LOGRECNO', 'index_right', 'NAME',
       'LISTNAME', 'MAPNAME', 'Shape_Leng', 'Shape_Area'],
      dtype='object')</code></pre>
</div>
</div>
<div id="cell-19" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The feature columns we want to use:</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> [</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sale_price"</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"total_livable_area"</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"total_area"</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"garage_spaces"</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fireplaces"</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"number_of_bathrooms"</span>,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"number_of_bedrooms"</span>,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"number_stories"</span>,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"exterior_condition"</span>,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GEOID10"</span>, </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NAME"</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Trim to these columns and remove NaNs</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>sales <span class="op">=</span> sales_geo2[cols <span class="op">+</span> [<span class="st">"geometry"</span>]].dropna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="train-a-random-forest-on-the-sales-data" class="level3">
<h3 class="anchored" data-anchor-id="train-a-random-forest-on-the-sales-data">2.4 Train a Random Forest on the sales data</h3>
<p>In this step, you should follow the steps outlined in lecture to preprocess and train your model. We’ll extend our analysis to do a hyperparameter grid search to find the best model configuration. As you train your model, follow the following steps:</p>
<p><strong>Preprocessing Requirements</strong> - Trim the sales data to those sales with prices between $3,000 and $1 million - Set up a pipeline that includes both numerical columns and categorical columns - Include one-hot encoded variable for the <em>neighborhood</em> of the sale, <strong>instead of ZIP code</strong>. We don’t want to include multiple location based categories, since they encode much of the same information.</p>
<p><strong>Training requirements</strong> - Use a 70/30% training/test split and predict the log of the sales price. - Use GridSearchCV to perform a k-fold cross validation that optimize <em>at least 2</em> hyperparameters of the RandomForestRegressor - After fitting your model and finding the optimal hyperparameters, you should evaluate the score (R-squared) on the test set (the original 30% sample withheld)</p>
<p><strong>Note</strong>: You don’t need to include additional features (such as spatial distance features) or perform any extra feature engineering beyond what is required above to receive full credit. Of course, you are always welcome to experiment!</p>
<div id="cell-21" class="cell" data-tags="[]" data-execution_count="30">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, OneHotEncoder</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline, make_pipeline</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, GridSearchCV</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> r2_score</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Preprocessing:</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter valid sales</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>valid <span class="op">=</span> (sales_geo2[<span class="st">'sale_price'</span>] <span class="op">&gt;</span> <span class="dv">3000</span>) <span class="op">&amp;</span> (sales_geo2[<span class="st">'sale_price'</span>] <span class="op">&lt;</span> <span class="dv">1000000</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>sales_final <span class="op">=</span> sales_geo2.loc[valid]</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Numerical columns</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>num_cols <span class="op">=</span> [</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"total_livable_area"</span>,</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"total_area"</span>,</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"garage_spaces"</span>,</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fireplaces"</span>,</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"number_of_bathrooms"</span>,</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"number_of_bedrooms"</span>,</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"number_stories"</span>,</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorical columns</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>cat_cols <span class="op">=</span> [<span class="st">"exterior_condition"</span>, <span class="st">"NAME"</span>]</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Preprocessor</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>transformer <span class="op">=</span> ColumnTransformer(</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    transformers<span class="op">=</span>[</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"num"</span>, StandardScaler(), num_cols),</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"cat"</span>, OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">"ignore"</span>), cat_cols),</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize RandomForestRegressor (no specific hyperparameters yet)</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> RandomForestRegressor(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Build pipeline</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> Pipeline(steps<span class="op">=</span>[</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'preprocessor'</span>, transformer),</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'regressor'</span>, rf)</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data 70/30</span></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>train_set, test_set <span class="op">=</span> train_test_split(sales_final, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate features (X) and target (y)</span></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> train_set.drop(columns<span class="op">=</span>[<span class="st">"sale_price"</span>])</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> test_set.drop(columns<span class="op">=</span>[<span class="st">"sale_price"</span>])</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> np.log(train_set[<span class="st">"sale_price"</span>])</span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> np.log(test_set[<span class="st">"sale_price"</span>])</span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Define hyperparameter grid for RandomForest</span></span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>    <span class="st">'regressor__n_estimators'</span>: [<span class="dv">50</span>, <span class="dv">100</span>],</span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>    <span class="st">'regressor__max_depth'</span>: [<span class="dv">10</span>, <span class="dv">20</span>],</span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>    <span class="st">'regressor__min_samples_split'</span>: [<span class="dv">2</span>, <span class="dv">5</span>]</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-22" class="cell" data-tags="[]" data-execution_count="31">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform GridSearchCV with k-fold cross-validation</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>grid_search <span class="op">=</span> GridSearchCV(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    pipe,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    param_grid<span class="op">=</span>param_grid,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    cv<span class="op">=</span><span class="dv">3</span>,  <span class="co"># k-fold cross-validation</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    scoring<span class="op">=</span><span class="st">'r2'</span>,  <span class="co"># R-squared as the scoring metric</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    n_jobs<span class="op">=-</span><span class="dv">1</span>,  <span class="co"># Use all processors</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="dv">2</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit GridSearchCV</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>grid_search.fit(X_train, y_train)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Best hyperparameters</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Best Parameters:"</span>, grid_search.best_params_)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate the model on the test set</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> grid_search.best_estimator_.predict(X_test)</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> r2_score(y_test, y_pred)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"R-squared on Test Set: </span><span class="sc">{</span>r2<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting 3 folds for each of 8 candidates, totalling 24 fits
Best Parameters: {'regressor__max_depth': 20, 'regressor__min_samples_split': 5, 'regressor__n_estimators': 100}
R-squared on Test Set: 0.5505</code></pre>
</div>
</div>
</section>
<section id="calculate-the-percent-error-of-your-model-predictions-for-each-sale-in-the-test-set" class="level3">
<h3 class="anchored" data-anchor-id="calculate-the-percent-error-of-your-model-predictions-for-each-sale-in-the-test-set">2.5 Calculate the percent error of your model predictions for each sale in the test set</h3>
<p>Fit your best model and use it to make predictions on the test set.</p>
<p><strong>Note:</strong> This should be the percent error in terms of <strong>sale price</strong>. You’ll need to convert if your model predicted the log of sales price!</p>
<div id="cell-24" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert log predictions back to original sale prices</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>y_pred_log <span class="op">=</span> grid_search.best_estimator_.predict(X_test)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> np.exp(y_pred_log)  <span class="co"># Convert from log scale to original scale</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Actual sale prices from the test set</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>y_actual <span class="op">=</span> np.exp(y_test)  <span class="co"># Convert log-transformed test target back to original scale</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate percent error for each sale</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>percent_error <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> np.<span class="bu">abs</span>((y_actual <span class="op">-</span> y_pred) <span class="op">/</span> y_actual)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Add percent error to a DataFrame for easier inspection</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>test_results <span class="op">=</span> test_set.copy()</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>test_results[<span class="st">"Actual Sale Price"</span>] <span class="op">=</span> y_actual</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>test_results[<span class="st">"Predicted Sale Price"</span>] <span class="op">=</span> y_pred</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>test_results[<span class="st">"Percent Error (%)"</span>] <span class="op">=</span> percent_error</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-25" class="cell" data-tags="[]" data-execution_count="36">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>test_results.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sale_price</th>
<th data-quarto-table-cell-role="th">total_livable_area</th>
<th data-quarto-table-cell-role="th">total_area</th>
<th data-quarto-table-cell-role="th">garage_spaces</th>
<th data-quarto-table-cell-role="th">fireplaces</th>
<th data-quarto-table-cell-role="th">number_of_bathrooms</th>
<th data-quarto-table-cell-role="th">number_of_bedrooms</th>
<th data-quarto-table-cell-role="th">number_stories</th>
<th data-quarto-table-cell-role="th">exterior_condition</th>
<th data-quarto-table-cell-role="th">zip_code</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">LOGRECNO</th>
<th data-quarto-table-cell-role="th">index_right</th>
<th data-quarto-table-cell-role="th">NAME</th>
<th data-quarto-table-cell-role="th">LISTNAME</th>
<th data-quarto-table-cell-role="th">MAPNAME</th>
<th data-quarto-table-cell-role="th">Shape_Leng</th>
<th data-quarto-table-cell-role="th">Shape_Area</th>
<th data-quarto-table-cell-role="th">Actual Sale Price</th>
<th data-quarto-table-cell-role="th">Predicted Sale Price</th>
<th data-quarto-table-cell-role="th">Percent Error (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">8156</td>
<td>120000.0</td>
<td>1284.0</td>
<td>1072.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>3.0</td>
<td>1.0</td>
<td>4</td>
<td>19143</td>
<td>...</td>
<td>10413</td>
<td>118</td>
<td>COBBS_CREEK</td>
<td>Cobbs Creek</td>
<td>Cobbs Creek</td>
<td>25355.994460</td>
<td>3.755230e+07</td>
<td>120000.0</td>
<td>153636.386142</td>
<td>28.030322</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13566</td>
<td>58500.0</td>
<td>1792.0</td>
<td>1120.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>4.0</td>
<td>2.0</td>
<td>4</td>
<td>19134</td>
<td>...</td>
<td>10509</td>
<td>76</td>
<td>UPPER_KENSINGTON</td>
<td>Upper Kensington</td>
<td>Upper Kensington</td>
<td>19841.099278</td>
<td>2.278303e+07</td>
<td>58500.0</td>
<td>83345.391195</td>
<td>42.470754</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22550</td>
<td>80000.0</td>
<td>1120.0</td>
<td>937.0</td>
<td>0.0</td>
<td>0.0</td>
<td>2.0</td>
<td>3.0</td>
<td>2.0</td>
<td>4</td>
<td>19142</td>
<td>...</td>
<td>10397</td>
<td>115</td>
<td>PASCHALL</td>
<td>Paschall</td>
<td>Paschall</td>
<td>22650.029678</td>
<td>1.966201e+07</td>
<td>80000.0</td>
<td>189014.571783</td>
<td>136.268215</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19208</td>
<td>150000.0</td>
<td>1046.0</td>
<td>1209.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>3.0</td>
<td>2.0</td>
<td>4</td>
<td>19136</td>
<td>...</td>
<td>10639</td>
<td>39</td>
<td>HOLMESBURG</td>
<td>Holmesburg</td>
<td>Holmesburg</td>
<td>40376.277535</td>
<td>8.406447e+07</td>
<td>150000.0</td>
<td>153004.834966</td>
<td>2.003223</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19616</td>
<td>157100.0</td>
<td>900.0</td>
<td>1396.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>4</td>
<td>19128</td>
<td>...</td>
<td>10536</td>
<td>50</td>
<td>ROXBOROUGH</td>
<td>Roxborough</td>
<td>Roxborough</td>
<td>23054.709844</td>
<td>2.241660e+07</td>
<td>157100.0</td>
<td>168547.045501</td>
<td>7.286471</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5193</td>
<td>100000.0</td>
<td>896.0</td>
<td>1293.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>3.0</td>
<td>2.0</td>
<td>4</td>
<td>19124</td>
<td>...</td>
<td>10517</td>
<td>73</td>
<td>JUNIATA_PARK</td>
<td>Juniata Park</td>
<td>Juniata Park</td>
<td>30347.187784</td>
<td>3.244185e+07</td>
<td>100000.0</td>
<td>118884.863137</td>
<td>18.884863</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18465</td>
<td>284999.0</td>
<td>820.0</td>
<td>786.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>4</td>
<td>19125</td>
<td>...</td>
<td>10488</td>
<td>149</td>
<td>EAST_KENSINGTON</td>
<td>East Kensington</td>
<td>East Kensington</td>
<td>11570.514789</td>
<td>7.672347e+06</td>
<td>284999.0</td>
<td>172547.643360</td>
<td>39.456755</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16338</td>
<td>200000.0</td>
<td>1360.0</td>
<td>3523.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>3.0</td>
<td>2.0</td>
<td>4</td>
<td>19154</td>
<td>...</td>
<td>10683</td>
<td>17</td>
<td>PARKWOOD_MANOR</td>
<td>Parkwood Manor</td>
<td>Parkwood Manor</td>
<td>36872.934875</td>
<td>4.700604e+07</td>
<td>200000.0</td>
<td>267007.092470</td>
<td>33.503546</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20174</td>
<td>26000.0</td>
<td>1182.0</td>
<td>845.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>3.0</td>
<td>2.0</td>
<td>4</td>
<td>19140</td>
<td>...</td>
<td>10526</td>
<td>62</td>
<td>TIOGA</td>
<td>Tioga</td>
<td>Tioga</td>
<td>27189.667081</td>
<td>3.162796e+07</td>
<td>26000.0</td>
<td>114379.990600</td>
<td>339.923041</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17738</td>
<td>17000.0</td>
<td>702.0</td>
<td>520.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>4</td>
<td>19140</td>
<td>...</td>
<td>10521</td>
<td>76</td>
<td>UPPER_KENSINGTON</td>
<td>Upper Kensington</td>
<td>Upper Kensington</td>
<td>19841.099278</td>
<td>2.278303e+07</td>
<td>17000.0</td>
<td>42469.103986</td>
<td>149.818259</td>
</tr>
</tbody>
</table>

<p>10 rows × 34 columns</p>
</div>
</div>
</div>
</section>
<section id="make-a-data-frame-with-percent-errors-and-census-tract-info-for-each-sale-in-the-test-set" class="level3">
<h3 class="anchored" data-anchor-id="make-a-data-frame-with-percent-errors-and-census-tract-info-for-each-sale-in-the-test-set">2.6 Make a data frame with percent errors and census tract info for each sale in the test set</h3>
<p>Create a data frame that has the property geometries, census tract data, and percent errors for all of the sales in the test set.</p>
<p><strong>Notes</strong></p>
<ul>
<li>When using the “train_test_split()” function, the index of the test data frame includes the labels from the original sales data frame</li>
<li>You can use this index to slice out the test data from the original sales data frame, which should include the census tract info and geometries</li>
<li>Add a new column to this data frame holding the percent error data</li>
<li>Make sure to use the percent error and not the absolute percent error</li>
</ul>
<div id="cell-27" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>test_data_with_geometry <span class="op">=</span> sales.loc[test_set.index]</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>test_data_census <span class="op">=</span> test_data_with_geometry.join(</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    test_results[<span class="st">"Percent Error (%)"</span>], how<span class="op">=</span><span class="st">"left"</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>test_data_census.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sale_price</th>
<th data-quarto-table-cell-role="th">total_livable_area</th>
<th data-quarto-table-cell-role="th">total_area</th>
<th data-quarto-table-cell-role="th">garage_spaces</th>
<th data-quarto-table-cell-role="th">fireplaces</th>
<th data-quarto-table-cell-role="th">number_of_bathrooms</th>
<th data-quarto-table-cell-role="th">number_of_bedrooms</th>
<th data-quarto-table-cell-role="th">number_stories</th>
<th data-quarto-table-cell-role="th">exterior_condition</th>
<th data-quarto-table-cell-role="th">GEOID10</th>
<th data-quarto-table-cell-role="th">NAME</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">Percent Error (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">8156</td>
<td>120000.0</td>
<td>1284.0</td>
<td>1072.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>3.0</td>
<td>1.0</td>
<td>4</td>
<td>42101008102</td>
<td>COBBS_CREEK</td>
<td>POINT (-75.23493 39.95220)</td>
<td>28.030322</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13566</td>
<td>58500.0</td>
<td>1792.0</td>
<td>1120.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>4.0</td>
<td>2.0</td>
<td>4</td>
<td>42101017702</td>
<td>UPPER_KENSINGTON</td>
<td>POINT (-75.12162 39.99780)</td>
<td>42.470754</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22550</td>
<td>80000.0</td>
<td>1120.0</td>
<td>937.0</td>
<td>0.0</td>
<td>0.0</td>
<td>2.0</td>
<td>3.0</td>
<td>2.0</td>
<td>4</td>
<td>42101006400</td>
<td>PASCHALL</td>
<td>POINT (-75.23767 39.92786)</td>
<td>136.268215</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19208</td>
<td>150000.0</td>
<td>1046.0</td>
<td>1209.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>3.0</td>
<td>2.0</td>
<td>4</td>
<td>42101032900</td>
<td>HOLMESBURG</td>
<td>POINT (-75.02733 40.03371)</td>
<td>2.003223</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19616</td>
<td>157100.0</td>
<td>900.0</td>
<td>1396.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>4</td>
<td>42101021000</td>
<td>ROXBOROUGH</td>
<td>POINT (-75.21195 40.02551)</td>
<td>7.286471</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="plot-a-map-of-the-median-percent-error-by-census-tract" class="level3">
<h3 class="anchored" data-anchor-id="plot-a-map-of-the-median-percent-error-by-census-tract">2.8 Plot a map of the median percent error by census tract</h3>
<ul>
<li>You’ll want to group your data frame of test sales by the <code>GEOID10</code> column and take the median of you percent error column</li>
<li>Merge the census tract geometries back in and use geopandas to plot.</li>
</ul>
<div id="cell-29" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Group by GEOID10 and calculate the median percent error</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>test_data_grouped <span class="op">=</span> test_data_census.groupby(<span class="st">"GEOID10"</span>)[<span class="st">"Percent Error (%)"</span>].median().reset_index()</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>test_data_grouped.rename(columns<span class="op">=</span>{<span class="st">"Percent Error (%)"</span>: <span class="st">"Median Percent Error"</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>test_data_tracts <span class="op">=</span> tracts.merge(test_data_grouped, on<span class="op">=</span><span class="st">"GEOID10"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-30" class="cell" data-tags="[]" data-execution_count="50">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>test_data_tracts.plot(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">"Median Percent Error"</span>,  <span class="co"># Data to color by</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">"coolwarm"</span>,  <span class="co"># Color map</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    legend_kwds<span class="op">=</span>{<span class="st">"label"</span>: <span class="st">"Median Percent Error (%)"</span>},</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    missing_kwds<span class="op">=</span>{<span class="st">"color"</span>: <span class="st">"lightgrey"</span>, <span class="st">"label"</span>: <span class="st">"No Data"</span>}</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Median Percent Error by Census Tract"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>ax.axis(<span class="st">"off"</span>)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="RS_VB_assignment-6_files/figure-html/cell-22-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>One census tract has a high error and is skewing the choropleth</p>
<div id="cell-32" class="cell" data-tags="[]" data-execution_count="53">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>test_data_tracts[<span class="st">"Error Quantile"</span>] <span class="op">=</span> pd.qcut(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    test_data_tracts[<span class="st">"Median Percent Error"</span>], </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    q<span class="op">=</span><span class="dv">4</span>,  <span class="co"># Divide into 4 quantiles (quartiles)</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[<span class="st">"Low"</span>, <span class="st">"Medium-Low"</span>, <span class="st">"Medium-High"</span>, <span class="st">"High"</span>]</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Plot using GeoPandas</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>test_data_tracts.plot(</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">"Error Quantile"</span>,  <span class="co"># Data to classify by</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">"coolwarm"</span>,  <span class="co"># Color map</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    legend_kwds<span class="op">=</span>{</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"title"</span>: <span class="st">"Percent Error Quantiles"</span>,</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"loc"</span>: <span class="st">"lower right"</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    missing_kwds<span class="op">=</span>{<span class="st">"color"</span>: <span class="st">"lightgrey"</span>, <span class="st">"label"</span>: <span class="st">"No Data"</span>}</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Median Percent Error by Census Tract (Classified by Quantiles)"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>ax.axis(<span class="st">"off"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="RS_VB_assignment-6_files/figure-html/cell-23-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Classifying the errors by quantiles reveals a clearer picture. Tracts in Central Philadelphia have a higher error rate than others.</p>
</section>
<section id="compare-the-percent-errors-in-qualifying-census-tracts-and-other-tracts" class="level3">
<h3 class="anchored" data-anchor-id="compare-the-percent-errors-in-qualifying-census-tracts-and-other-tracts">2.9 Compare the percent errors in Qualifying Census Tracts and other tracts</h3>
<p><a href="https://www.huduser.gov/portal/datasets/qct.html">Qualifying Census Tracts</a> are a poverty designation that HUD uses to allocate housing tax credits</p>
<ul>
<li>I’ve included a list of the census tract names that qualify in Philadelphia</li>
<li>Add a new column to your dataframe of test set sales that is True/False depending on if the tract is a QCT</li>
<li>Then, group by this new column and calculate the median percent error</li>
</ul>
<p><strong>You should find that the algorithm’s accuracy is significantly worse in these low-income, qualifying census tracts</strong></p>
<div id="cell-35" class="cell" data-tags="[]" data-execution_count="57">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>test_data_tracts2 <span class="op">=</span> test_data_tracts.merge(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    tracts[[<span class="st">'GEOID10'</span>, <span class="st">'NAME10'</span>]],  <span class="co"># Select only GEOID and NAME10 columns</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span><span class="st">'GEOID10'</span>, </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">'left'</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>test_data_tracts2.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">OBJECTID</th>
<th data-quarto-table-cell-role="th">STATEFP10</th>
<th data-quarto-table-cell-role="th">COUNTYFP10</th>
<th data-quarto-table-cell-role="th">TRACTCE10</th>
<th data-quarto-table-cell-role="th">GEOID10</th>
<th data-quarto-table-cell-role="th">NAME10_x</th>
<th data-quarto-table-cell-role="th">NAMELSAD10</th>
<th data-quarto-table-cell-role="th">MTFCC10</th>
<th data-quarto-table-cell-role="th">FUNCSTAT10</th>
<th data-quarto-table-cell-role="th">ALAND10</th>
<th data-quarto-table-cell-role="th">AWATER10</th>
<th data-quarto-table-cell-role="th">INTPTLAT10</th>
<th data-quarto-table-cell-role="th">INTPTLON10</th>
<th data-quarto-table-cell-role="th">LOGRECNO</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">Median Percent Error</th>
<th data-quarto-table-cell-role="th">Error Quantile</th>
<th data-quarto-table-cell-role="th">NAME10_y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>42</td>
<td>101</td>
<td>009400</td>
<td>42101009400</td>
<td>94</td>
<td>Census Tract 94</td>
<td>G5020</td>
<td>S</td>
<td>366717</td>
<td>0</td>
<td>+39.9632709</td>
<td>-075.2322437</td>
<td>10429</td>
<td>POLYGON ((-75.22927 39.96054, -75.22865 39.960...</td>
<td>52.133105</td>
<td>High</td>
<td>94</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>42</td>
<td>101</td>
<td>009500</td>
<td>42101009500</td>
<td>95</td>
<td>Census Tract 95</td>
<td>G5020</td>
<td>S</td>
<td>319070</td>
<td>0</td>
<td>+39.9658709</td>
<td>-075.2379140</td>
<td>10430</td>
<td>POLYGON ((-75.23536 39.96852, -75.23545 39.969...</td>
<td>43.830656</td>
<td>High</td>
<td>95</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>42</td>
<td>101</td>
<td>009600</td>
<td>42101009600</td>
<td>96</td>
<td>Census Tract 96</td>
<td>G5020</td>
<td>S</td>
<td>405273</td>
<td>0</td>
<td>+39.9655396</td>
<td>-075.2435075</td>
<td>10431</td>
<td>POLYGON ((-75.24343 39.96230, -75.24339 39.962...</td>
<td>41.781578</td>
<td>High</td>
<td>96</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>42</td>
<td>101</td>
<td>013800</td>
<td>42101013800</td>
<td>138</td>
<td>Census Tract 138</td>
<td>G5020</td>
<td>S</td>
<td>341256</td>
<td>0</td>
<td>+39.9764504</td>
<td>-075.1771771</td>
<td>10468</td>
<td>POLYGON ((-75.17341 39.97779, -75.17386 39.977...</td>
<td>38.237322</td>
<td>High</td>
<td>138</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>42</td>
<td>101</td>
<td>013900</td>
<td>42101013900</td>
<td>139</td>
<td>Census Tract 139</td>
<td>G5020</td>
<td>S</td>
<td>562934</td>
<td>0</td>
<td>+39.9750563</td>
<td>-075.1711846</td>
<td>10469</td>
<td>POLYGON ((-75.17313 39.97776, -75.17321 39.977...</td>
<td>7.764229</td>
<td>Low</td>
<td>139</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-36" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>qct <span class="op">=</span> [<span class="st">'5'</span>,</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a> <span class="st">'20'</span>,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a> <span class="st">'22'</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'28.01'</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'30.01'</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'30.02'</span>,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'31'</span>,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'32'</span>,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'33'</span>,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'36'</span>,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a> <span class="st">'37.01'</span>,</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a> <span class="st">'37.02'</span>,</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a> <span class="st">'39.01'</span>,</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a> <span class="st">'41.01'</span>,</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a> <span class="st">'41.02'</span>,</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a> <span class="st">'56'</span>,</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a> <span class="st">'60'</span>,</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a> <span class="st">'61'</span>,</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a> <span class="st">'62'</span>,</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a> <span class="st">'63'</span>,</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a> <span class="st">'64'</span>,</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a> <span class="st">'65'</span>,</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a> <span class="st">'66'</span>,</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a> <span class="st">'67'</span>,</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a> <span class="st">'69'</span>,</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a> <span class="st">'70'</span>,</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a> <span class="st">'71.01'</span>,</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a> <span class="st">'71.02'</span>,</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a> <span class="st">'72'</span>,</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a> <span class="st">'73'</span>,</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a> <span class="st">'74'</span>,</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a> <span class="st">'77'</span>,</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a> <span class="st">'78'</span>,</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a> <span class="st">'80'</span>,</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a> <span class="st">'81.01'</span>,</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a> <span class="st">'81.02'</span>,</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a> <span class="st">'82'</span>,</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a> <span class="st">'83.01'</span>,</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a> <span class="st">'83.02'</span>,</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a> <span class="st">'84'</span>,</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a> <span class="st">'85'</span>,</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a> <span class="st">'86.01'</span>,</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a> <span class="st">'86.02'</span>,</span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a> <span class="st">'87.01'</span>,</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a> <span class="st">'87.02'</span>,</span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a> <span class="st">'88.01'</span>,</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a> <span class="st">'88.02'</span>,</span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a> <span class="st">'90'</span>,</span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a> <span class="st">'91'</span>,</span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a> <span class="st">'92'</span>,</span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a> <span class="st">'93'</span>,</span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a> <span class="st">'94'</span>,</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a> <span class="st">'95'</span>,</span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a> <span class="st">'96'</span>,</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a> <span class="st">'98.01'</span>,</span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a> <span class="st">'100'</span>,</span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a> <span class="st">'101'</span>,</span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a> <span class="st">'102'</span>,</span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a> <span class="st">'103'</span>,</span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a> <span class="st">'104'</span>,</span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a> <span class="st">'105'</span>,</span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a> <span class="st">'106'</span>,</span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a> <span class="st">'107'</span>,</span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a> <span class="st">'108'</span>,</span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a> <span class="st">'109'</span>,</span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a> <span class="st">'110'</span>,</span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a> <span class="st">'111'</span>,</span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a> <span class="st">'112'</span>,</span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a> <span class="st">'113'</span>,</span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a> <span class="st">'119'</span>,</span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a> <span class="st">'121'</span>,</span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a> <span class="st">'122.01'</span>,</span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a> <span class="st">'122.03'</span>,</span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a> <span class="st">'131'</span>,</span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a> <span class="st">'132'</span>,</span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a> <span class="st">'137'</span>,</span>
<span id="cb26-77"><a href="#cb26-77" aria-hidden="true" tabindex="-1"></a> <span class="st">'138'</span>,</span>
<span id="cb26-78"><a href="#cb26-78" aria-hidden="true" tabindex="-1"></a> <span class="st">'139'</span>,</span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a> <span class="st">'140'</span>,</span>
<span id="cb26-80"><a href="#cb26-80" aria-hidden="true" tabindex="-1"></a> <span class="st">'141'</span>,</span>
<span id="cb26-81"><a href="#cb26-81" aria-hidden="true" tabindex="-1"></a> <span class="st">'144'</span>,</span>
<span id="cb26-82"><a href="#cb26-82" aria-hidden="true" tabindex="-1"></a> <span class="st">'145'</span>,</span>
<span id="cb26-83"><a href="#cb26-83" aria-hidden="true" tabindex="-1"></a> <span class="st">'146'</span>,</span>
<span id="cb26-84"><a href="#cb26-84" aria-hidden="true" tabindex="-1"></a> <span class="st">'147'</span>,</span>
<span id="cb26-85"><a href="#cb26-85" aria-hidden="true" tabindex="-1"></a> <span class="st">'148'</span>,</span>
<span id="cb26-86"><a href="#cb26-86" aria-hidden="true" tabindex="-1"></a> <span class="st">'149'</span>,</span>
<span id="cb26-87"><a href="#cb26-87" aria-hidden="true" tabindex="-1"></a> <span class="st">'151.01'</span>,</span>
<span id="cb26-88"><a href="#cb26-88" aria-hidden="true" tabindex="-1"></a> <span class="st">'151.02'</span>,</span>
<span id="cb26-89"><a href="#cb26-89" aria-hidden="true" tabindex="-1"></a> <span class="st">'152'</span>,</span>
<span id="cb26-90"><a href="#cb26-90" aria-hidden="true" tabindex="-1"></a> <span class="st">'153'</span>,</span>
<span id="cb26-91"><a href="#cb26-91" aria-hidden="true" tabindex="-1"></a> <span class="st">'156'</span>,</span>
<span id="cb26-92"><a href="#cb26-92" aria-hidden="true" tabindex="-1"></a> <span class="st">'157'</span>,</span>
<span id="cb26-93"><a href="#cb26-93" aria-hidden="true" tabindex="-1"></a> <span class="st">'161'</span>,</span>
<span id="cb26-94"><a href="#cb26-94" aria-hidden="true" tabindex="-1"></a> <span class="st">'162'</span>,</span>
<span id="cb26-95"><a href="#cb26-95" aria-hidden="true" tabindex="-1"></a> <span class="st">'163'</span>,</span>
<span id="cb26-96"><a href="#cb26-96" aria-hidden="true" tabindex="-1"></a> <span class="st">'164'</span>,</span>
<span id="cb26-97"><a href="#cb26-97" aria-hidden="true" tabindex="-1"></a> <span class="st">'165'</span>,</span>
<span id="cb26-98"><a href="#cb26-98" aria-hidden="true" tabindex="-1"></a> <span class="st">'167.01'</span>,</span>
<span id="cb26-99"><a href="#cb26-99" aria-hidden="true" tabindex="-1"></a> <span class="st">'167.02'</span>,</span>
<span id="cb26-100"><a href="#cb26-100" aria-hidden="true" tabindex="-1"></a> <span class="st">'168'</span>,</span>
<span id="cb26-101"><a href="#cb26-101" aria-hidden="true" tabindex="-1"></a> <span class="st">'169.01'</span>,</span>
<span id="cb26-102"><a href="#cb26-102" aria-hidden="true" tabindex="-1"></a> <span class="st">'169.02'</span>,</span>
<span id="cb26-103"><a href="#cb26-103" aria-hidden="true" tabindex="-1"></a> <span class="st">'170'</span>,</span>
<span id="cb26-104"><a href="#cb26-104" aria-hidden="true" tabindex="-1"></a> <span class="st">'171'</span>,</span>
<span id="cb26-105"><a href="#cb26-105" aria-hidden="true" tabindex="-1"></a> <span class="st">'172.01'</span>,</span>
<span id="cb26-106"><a href="#cb26-106" aria-hidden="true" tabindex="-1"></a> <span class="st">'172.02'</span>,</span>
<span id="cb26-107"><a href="#cb26-107" aria-hidden="true" tabindex="-1"></a> <span class="st">'173'</span>,</span>
<span id="cb26-108"><a href="#cb26-108" aria-hidden="true" tabindex="-1"></a> <span class="st">'174'</span>,</span>
<span id="cb26-109"><a href="#cb26-109" aria-hidden="true" tabindex="-1"></a> <span class="st">'175'</span>,</span>
<span id="cb26-110"><a href="#cb26-110" aria-hidden="true" tabindex="-1"></a> <span class="st">'176.01'</span>,</span>
<span id="cb26-111"><a href="#cb26-111" aria-hidden="true" tabindex="-1"></a> <span class="st">'176.02'</span>,</span>
<span id="cb26-112"><a href="#cb26-112" aria-hidden="true" tabindex="-1"></a> <span class="st">'177.01'</span>,</span>
<span id="cb26-113"><a href="#cb26-113" aria-hidden="true" tabindex="-1"></a> <span class="st">'177.02'</span>,</span>
<span id="cb26-114"><a href="#cb26-114" aria-hidden="true" tabindex="-1"></a> <span class="st">'178'</span>,</span>
<span id="cb26-115"><a href="#cb26-115" aria-hidden="true" tabindex="-1"></a> <span class="st">'179'</span>,</span>
<span id="cb26-116"><a href="#cb26-116" aria-hidden="true" tabindex="-1"></a> <span class="st">'180.02'</span>,</span>
<span id="cb26-117"><a href="#cb26-117" aria-hidden="true" tabindex="-1"></a> <span class="st">'188'</span>,</span>
<span id="cb26-118"><a href="#cb26-118" aria-hidden="true" tabindex="-1"></a> <span class="st">'190'</span>,</span>
<span id="cb26-119"><a href="#cb26-119" aria-hidden="true" tabindex="-1"></a> <span class="st">'191'</span>,</span>
<span id="cb26-120"><a href="#cb26-120" aria-hidden="true" tabindex="-1"></a> <span class="st">'192'</span>,</span>
<span id="cb26-121"><a href="#cb26-121" aria-hidden="true" tabindex="-1"></a> <span class="st">'195.01'</span>,</span>
<span id="cb26-122"><a href="#cb26-122" aria-hidden="true" tabindex="-1"></a> <span class="st">'195.02'</span>,</span>
<span id="cb26-123"><a href="#cb26-123" aria-hidden="true" tabindex="-1"></a> <span class="st">'197'</span>,</span>
<span id="cb26-124"><a href="#cb26-124" aria-hidden="true" tabindex="-1"></a> <span class="st">'198'</span>,</span>
<span id="cb26-125"><a href="#cb26-125" aria-hidden="true" tabindex="-1"></a> <span class="st">'199'</span>,</span>
<span id="cb26-126"><a href="#cb26-126" aria-hidden="true" tabindex="-1"></a> <span class="st">'200'</span>,</span>
<span id="cb26-127"><a href="#cb26-127" aria-hidden="true" tabindex="-1"></a> <span class="st">'201.01'</span>,</span>
<span id="cb26-128"><a href="#cb26-128" aria-hidden="true" tabindex="-1"></a> <span class="st">'201.02'</span>,</span>
<span id="cb26-129"><a href="#cb26-129" aria-hidden="true" tabindex="-1"></a> <span class="st">'202'</span>,</span>
<span id="cb26-130"><a href="#cb26-130" aria-hidden="true" tabindex="-1"></a> <span class="st">'203'</span>,</span>
<span id="cb26-131"><a href="#cb26-131" aria-hidden="true" tabindex="-1"></a> <span class="st">'204'</span>,</span>
<span id="cb26-132"><a href="#cb26-132" aria-hidden="true" tabindex="-1"></a> <span class="st">'205'</span>,</span>
<span id="cb26-133"><a href="#cb26-133" aria-hidden="true" tabindex="-1"></a> <span class="st">'206'</span>,</span>
<span id="cb26-134"><a href="#cb26-134" aria-hidden="true" tabindex="-1"></a> <span class="st">'208'</span>,</span>
<span id="cb26-135"><a href="#cb26-135" aria-hidden="true" tabindex="-1"></a> <span class="st">'239'</span>,</span>
<span id="cb26-136"><a href="#cb26-136" aria-hidden="true" tabindex="-1"></a> <span class="st">'240'</span>,</span>
<span id="cb26-137"><a href="#cb26-137" aria-hidden="true" tabindex="-1"></a> <span class="st">'241'</span>,</span>
<span id="cb26-138"><a href="#cb26-138" aria-hidden="true" tabindex="-1"></a> <span class="st">'242'</span>,</span>
<span id="cb26-139"><a href="#cb26-139" aria-hidden="true" tabindex="-1"></a> <span class="st">'243'</span>,</span>
<span id="cb26-140"><a href="#cb26-140" aria-hidden="true" tabindex="-1"></a> <span class="st">'244'</span>,</span>
<span id="cb26-141"><a href="#cb26-141" aria-hidden="true" tabindex="-1"></a> <span class="st">'245'</span>,</span>
<span id="cb26-142"><a href="#cb26-142" aria-hidden="true" tabindex="-1"></a> <span class="st">'246'</span>,</span>
<span id="cb26-143"><a href="#cb26-143" aria-hidden="true" tabindex="-1"></a> <span class="st">'247'</span>,</span>
<span id="cb26-144"><a href="#cb26-144" aria-hidden="true" tabindex="-1"></a> <span class="st">'249'</span>,</span>
<span id="cb26-145"><a href="#cb26-145" aria-hidden="true" tabindex="-1"></a> <span class="st">'252'</span>,</span>
<span id="cb26-146"><a href="#cb26-146" aria-hidden="true" tabindex="-1"></a> <span class="st">'253'</span>,</span>
<span id="cb26-147"><a href="#cb26-147" aria-hidden="true" tabindex="-1"></a> <span class="st">'265'</span>,</span>
<span id="cb26-148"><a href="#cb26-148" aria-hidden="true" tabindex="-1"></a> <span class="st">'267'</span>,</span>
<span id="cb26-149"><a href="#cb26-149" aria-hidden="true" tabindex="-1"></a> <span class="st">'268'</span>,</span>
<span id="cb26-150"><a href="#cb26-150" aria-hidden="true" tabindex="-1"></a> <span class="st">'271'</span>,</span>
<span id="cb26-151"><a href="#cb26-151" aria-hidden="true" tabindex="-1"></a> <span class="st">'274.01'</span>,</span>
<span id="cb26-152"><a href="#cb26-152" aria-hidden="true" tabindex="-1"></a> <span class="st">'274.02'</span>,</span>
<span id="cb26-153"><a href="#cb26-153" aria-hidden="true" tabindex="-1"></a> <span class="st">'275'</span>,</span>
<span id="cb26-154"><a href="#cb26-154" aria-hidden="true" tabindex="-1"></a> <span class="st">'276'</span>,</span>
<span id="cb26-155"><a href="#cb26-155" aria-hidden="true" tabindex="-1"></a> <span class="st">'277'</span>,</span>
<span id="cb26-156"><a href="#cb26-156" aria-hidden="true" tabindex="-1"></a> <span class="st">'278'</span>,</span>
<span id="cb26-157"><a href="#cb26-157" aria-hidden="true" tabindex="-1"></a> <span class="st">'279.01'</span>,</span>
<span id="cb26-158"><a href="#cb26-158" aria-hidden="true" tabindex="-1"></a> <span class="st">'279.02'</span>,</span>
<span id="cb26-159"><a href="#cb26-159" aria-hidden="true" tabindex="-1"></a> <span class="st">'280'</span>,</span>
<span id="cb26-160"><a href="#cb26-160" aria-hidden="true" tabindex="-1"></a> <span class="st">'281'</span>,</span>
<span id="cb26-161"><a href="#cb26-161" aria-hidden="true" tabindex="-1"></a> <span class="st">'282'</span>,</span>
<span id="cb26-162"><a href="#cb26-162" aria-hidden="true" tabindex="-1"></a> <span class="st">'283'</span>,</span>
<span id="cb26-163"><a href="#cb26-163" aria-hidden="true" tabindex="-1"></a> <span class="st">'284'</span>,</span>
<span id="cb26-164"><a href="#cb26-164" aria-hidden="true" tabindex="-1"></a> <span class="st">'285'</span>,</span>
<span id="cb26-165"><a href="#cb26-165" aria-hidden="true" tabindex="-1"></a> <span class="st">'286'</span>,</span>
<span id="cb26-166"><a href="#cb26-166" aria-hidden="true" tabindex="-1"></a> <span class="st">'287'</span>,</span>
<span id="cb26-167"><a href="#cb26-167" aria-hidden="true" tabindex="-1"></a> <span class="st">'288'</span>,</span>
<span id="cb26-168"><a href="#cb26-168" aria-hidden="true" tabindex="-1"></a> <span class="st">'289.01'</span>,</span>
<span id="cb26-169"><a href="#cb26-169" aria-hidden="true" tabindex="-1"></a> <span class="st">'289.02'</span>,</span>
<span id="cb26-170"><a href="#cb26-170" aria-hidden="true" tabindex="-1"></a> <span class="st">'290'</span>,</span>
<span id="cb26-171"><a href="#cb26-171" aria-hidden="true" tabindex="-1"></a> <span class="st">'291'</span>,</span>
<span id="cb26-172"><a href="#cb26-172" aria-hidden="true" tabindex="-1"></a> <span class="st">'293'</span>,</span>
<span id="cb26-173"><a href="#cb26-173" aria-hidden="true" tabindex="-1"></a> <span class="st">'294'</span>,</span>
<span id="cb26-174"><a href="#cb26-174" aria-hidden="true" tabindex="-1"></a> <span class="st">'298'</span>,</span>
<span id="cb26-175"><a href="#cb26-175" aria-hidden="true" tabindex="-1"></a> <span class="st">'299'</span>,</span>
<span id="cb26-176"><a href="#cb26-176" aria-hidden="true" tabindex="-1"></a> <span class="st">'300'</span>,</span>
<span id="cb26-177"><a href="#cb26-177" aria-hidden="true" tabindex="-1"></a> <span class="st">'301'</span>,</span>
<span id="cb26-178"><a href="#cb26-178" aria-hidden="true" tabindex="-1"></a> <span class="st">'302'</span>,</span>
<span id="cb26-179"><a href="#cb26-179" aria-hidden="true" tabindex="-1"></a> <span class="st">'305.01'</span>,</span>
<span id="cb26-180"><a href="#cb26-180" aria-hidden="true" tabindex="-1"></a> <span class="st">'305.02'</span>,</span>
<span id="cb26-181"><a href="#cb26-181" aria-hidden="true" tabindex="-1"></a> <span class="st">'309'</span>,</span>
<span id="cb26-182"><a href="#cb26-182" aria-hidden="true" tabindex="-1"></a> <span class="st">'311.01'</span>,</span>
<span id="cb26-183"><a href="#cb26-183" aria-hidden="true" tabindex="-1"></a> <span class="st">'312'</span>,</span>
<span id="cb26-184"><a href="#cb26-184" aria-hidden="true" tabindex="-1"></a> <span class="st">'313'</span>,</span>
<span id="cb26-185"><a href="#cb26-185" aria-hidden="true" tabindex="-1"></a> <span class="st">'314.01'</span>,</span>
<span id="cb26-186"><a href="#cb26-186" aria-hidden="true" tabindex="-1"></a> <span class="st">'314.02'</span>,</span>
<span id="cb26-187"><a href="#cb26-187" aria-hidden="true" tabindex="-1"></a> <span class="st">'316'</span>,</span>
<span id="cb26-188"><a href="#cb26-188" aria-hidden="true" tabindex="-1"></a> <span class="st">'318'</span>,</span>
<span id="cb26-189"><a href="#cb26-189" aria-hidden="true" tabindex="-1"></a> <span class="st">'319'</span>,</span>
<span id="cb26-190"><a href="#cb26-190" aria-hidden="true" tabindex="-1"></a> <span class="st">'321'</span>,</span>
<span id="cb26-191"><a href="#cb26-191" aria-hidden="true" tabindex="-1"></a> <span class="st">'325'</span>,</span>
<span id="cb26-192"><a href="#cb26-192" aria-hidden="true" tabindex="-1"></a> <span class="st">'329'</span>,</span>
<span id="cb26-193"><a href="#cb26-193" aria-hidden="true" tabindex="-1"></a> <span class="st">'330'</span>,</span>
<span id="cb26-194"><a href="#cb26-194" aria-hidden="true" tabindex="-1"></a> <span class="st">'337.01'</span>,</span>
<span id="cb26-195"><a href="#cb26-195" aria-hidden="true" tabindex="-1"></a> <span class="st">'345.01'</span>,</span>
<span id="cb26-196"><a href="#cb26-196" aria-hidden="true" tabindex="-1"></a> <span class="st">'357.01'</span>,</span>
<span id="cb26-197"><a href="#cb26-197" aria-hidden="true" tabindex="-1"></a> <span class="st">'376'</span>,</span>
<span id="cb26-198"><a href="#cb26-198" aria-hidden="true" tabindex="-1"></a> <span class="st">'377'</span>,</span>
<span id="cb26-199"><a href="#cb26-199" aria-hidden="true" tabindex="-1"></a> <span class="st">'380'</span>,</span>
<span id="cb26-200"><a href="#cb26-200" aria-hidden="true" tabindex="-1"></a> <span class="st">'381'</span>,</span>
<span id="cb26-201"><a href="#cb26-201" aria-hidden="true" tabindex="-1"></a> <span class="st">'382'</span>,</span>
<span id="cb26-202"><a href="#cb26-202" aria-hidden="true" tabindex="-1"></a> <span class="st">'383'</span>,</span>
<span id="cb26-203"><a href="#cb26-203" aria-hidden="true" tabindex="-1"></a> <span class="st">'389'</span>,</span>
<span id="cb26-204"><a href="#cb26-204" aria-hidden="true" tabindex="-1"></a> <span class="st">'390'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-37" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>test_data_tracts[<span class="st">'Is_QCT'</span>] <span class="op">=</span> test_data_tracts[<span class="st">'NAME10'</span>].isin(qct)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Group by the new Is_QCT column and calculate median percent error</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>median_percent_error_by_qct <span class="op">=</span> test_data_tracts.groupby(<span class="st">'Is_QCT'</span>)[<span class="st">'Median Percent Error'</span>].median().reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-38" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>median_percent_error_by_qct.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Is_QCT</th>
<th data-quarto-table-cell-role="th">Median Percent Error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>False</td>
<td>18.394039</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>True</td>
<td>30.441475</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The table shows that the error rate for predicting sales prices is significantly higher for Qualified Census Tracts than non QCTs, as expected.</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>vbhakhri@upenn.edu</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This page is built with ❤️ and <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>